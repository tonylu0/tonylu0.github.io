
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../images/text-box-outline.svg">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.3.2">
    
    
      
        <title>FastAI on VastAI - Tony Lu</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.24c991ad.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#fastai-on-vastai" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Tony Lu" class="md-header__button md-logo" aria-label="Tony Lu" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 3c-1.11 0-2 .89-2 2v14c0 1.11.89 2 2 2h14c1.11 0 2-.89 2-2V5c0-1.11-.89-2-2-2H5m0 2h14v14H5V5m2 2v2h10V7H7m0 4v2h10v-2H7m0 4v2h7v-2H7z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tony Lu
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              FastAI on VastAI
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Tony Lu" class="md-nav__button md-logo" aria-label="Tony Lu" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 3c-1.11 0-2 .89-2 2v14c0 1.11.89 2 2 2h14c1.11 0 2-.89 2-2V5c0-1.11-.89-2-2-2H5m0 2h14v14H5V5m2 2v2h10V7H7m0 4v2h10v-2H7m0 4v2h7v-2H7z"/></svg>

    </a>
    Tony Lu
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../recommendations/" class="md-nav__link">
        Cloud GPU Recommendations
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          FastAI on VastAI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        FastAI on VastAI
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-the-account" class="md-nav__link">
    Setting up the account
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#provisioning-a-remote-gpu-server" class="md-nav__link">
    Provisioning a remote GPU server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connecting-to-the-server" class="md-nav__link">
    Connecting to the server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-programs-in-the-server" class="md-nav__link">
    Running programs in the server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#saving-your-work" class="md-nav__link">
    Saving your work
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shutting-down-the-server" class="md-nav__link">
    Shutting down the server
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Anime Face Generator
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Anime Face Generator" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Anime Face Generator
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../animefacegenerator/" class="md-nav__link">
        Project Home
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../animefacecrop/" class="md-nav__link">
        Anime Face Cropper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../imagepreprocess/" class="md-nav__link">
        Image Preprocessor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dockerimage/" class="md-nav__link">
        Custom Docker Image for GAN training
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        About Me
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-the-account" class="md-nav__link">
    Setting up the account
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#provisioning-a-remote-gpu-server" class="md-nav__link">
    Provisioning a remote GPU server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connecting-to-the-server" class="md-nav__link">
    Connecting to the server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-programs-in-the-server" class="md-nav__link">
    Running programs in the server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#saving-your-work" class="md-nav__link">
    Saving your work
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shutting-down-the-server" class="md-nav__link">
    Shutting down the server
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="fastai-on-vastai">FastAI on VastAI</h1>
<h2 id="introduction">Introduction</h2>
<p>There is a <a href="https://youtu.be/6DTfC3PK_4U">video version of the tutorial on Youtube</a>.</p>
<p>This is the text version of the tutorial. It is frequently updated with the latest
information and is the fastest method to getting started.</p>
<hr />
<p>This tutorial allows you to utilize VastAI, a cloud gpu rental service,
to run FastAI, a great AI kickstarter library. While services like Paperspace
and other cloud GPU providers can provide introductory GPUs, a problem arises
when more compute is needed. Utilizing powerful hardware on popular cloud providers
can prove to be expensive. Therefore, VastAI provides a solution by allowing consumers
to rent out their personal GPUs to be used, resulting in a decrease in price.</p>
<p>To get started, to go the <a href="https://vast.ai/">VastAI website</a> and create an account.</p>
<p><img alt="vastaihomepage" src="/images/vastaihomepage.png" /></p>
<p>After you have created an account, click on the console button at the top right of the website.</p>
<p><img alt="vastaiconsole" src="/images/vastaiconsole.png" /></p>
<hr />
<h2 id="setting-up-the-account">Setting up the account</h2>
<p>This brings you to the main page where you can create and rent servers. However, for now, go to
the billing page.</p>
<p><img alt="vastaibilling" src="/images/vastaibilling.png" /></p>
<p>From here, you can add credit, and the minimum is $5.
After this, you can go to the the account page to set up the SSH key.</p>
<p><img alt="vastaissh" src="/images/vastaissh.png" /></p>
<p>You can get the SSH key through various methods. This guide will show you how to obtain it using 
a windows machine with SSH installed through Windows subsystem for linux 2.</p>
<p>For windows uers with SSH set up, go to <code>C:\Users\*Insert Current user*\.ssh</code></p>
<p><img alt="windowssshkey" src="/images/windowssshkey.png" /></p>
<p>In this folder, you will see 3 files. The first two files are the Private and Public SSH keys, and the
third file is the SSH connection history. You will want to select the file with the "Pub" extension,
which indicates that it is the public SSH key. You can then paste this into the SSH key field on the 
VastAI website.</p>
<p>Be sure to only paste the public key. It is the shorter of the two keys, and has a smaller file size.
VastAI will warn you if you paste your private key by mistake.</p>
<hr />
<h2 id="provisioning-a-remote-gpu-server">Provisioning a remote GPU server</h2>
<p>After this, we can finally start up a server! First, go to the create page. I recommend setting the GPU 
count filter to 1. This allows us to focus only on servers that have 1 GPU. This filter can be adjusted
later on when more GPUs can be utilized.</p>
<p><img alt="vastaigpucount" src="/images/vastaigpucount.png" /></p>
<p>Next, click on <code>Edit image &amp; config</code>. Here, you can see various docker images that can be loaded up
to the remote servers. Go all the way to the bottom and select the custom container option and enter 
<code>fastdotai/fastai-course</code>.</p>
<p><img alt="vastaiselectimage" src="/images/vastaiselectimage.png" /></p>
<p>Next, we will find an appropriate server. For getting used to VastAI, I recommend sorting by price
ascending. This allows us to choose the cheapest servers to familiarize the setup with. Later on you
can use DLPerf/$/Hour which optimizes for efficiency.</p>
<p><img alt="vastaicheapest" src="/images/vastaicheapest.png" /></p>
<p>For this specific instance, it is important to note that other than the base rental fee of $0.297/hour, there is a storage fee
of $0.00694/hour/10gb as well as an internet transfer fee of $0.02/GB. This internet transfer fee
can become significant if you are transferring a large amount of data such as downloading training 
data to the instance or downloading finished models from the instance. This can be avoided by preloading
the data to the docker containers by using a custom docker container. There will be a guide on how to do this
in the future.</p>
<p>Other instances will have different prices for the storage as well as internet transfer.</p>
<hr />
<h2 id="connecting-to-the-server">Connecting to the server</h2>
<p>Once you have chosen a server to rent, you can click on the rent button and then go to the instances page.
Here you will be able to see the status of the instance. It usually takes a few minutes for the instance
to be set up depending on the internet speed. At the time of writing, you will not be charged for the time 
it takes to set up the instance and the internet transfer from downloading the instance. You can see the 
status of the docker container and updates on the bottom after refreshing the page.</p>
<p><img alt="vastaiconnect" src="/images/vastaiconnect.png" /></p>
<p>After the instance is done setting up, you can click on the connect button. This brings up a popup with 
the command to connect using SSH. Clicking on the command will highlight the entire command, which can 
then be copied. After copying the SSH command, open up a terminal where SSH is installed. I will show 
connecting to SSH using Windows Command Prompt.</p>
<p>After opening up Command Prompt, right clicking anywhere will paste the contents of the command. After entering
the command, it might say connection refused. If it does, just keep on entering the command until it works.
When it says if you want to continue, type in <code>yes</code>.</p>
<p><img alt="vastaisshclient" src="/images/vastaisshclient.png" /></p>
<p>Once you have reached this step, type in <code>cd ..</code> to go to the upper folder. Then type <code>cd workspace</code>.
After typing <code>ls</code>, we can see the contents of this folder.</p>
<p>Then type <code>jupyter notebook --port=8080 --allow-root --no-browser</code> to launch the jupyter notebook.
You will see the links to connect to the jupyter notebook in the terminal.</p>
<p><img alt="vastaisshjupyterconnect" src="/images/vastaisshjupyterconnect.png" /></p>
<p>After pasting the link in the web browser, you will see your standard jupyter notebook interface. You can 
now use as any other jupyter notebook.</p>
<hr />
<h2 id="running-programs-in-the-server">Running programs in the server</h2>
<p><img alt="vastaijupyternotebook" src="/images/vastaijupyternotebook.png" /></p>
<p>You can then go into <code>fastbook</code> where the notebooks from the course <code>https://github.com/fastai/fastbook</code>
are cloned in. Remember that your current machine may not has as much VRAM as you need so there might be memory
errors. I recommend using machines with at least 16GB of VRAM to avoid memory errors. The current instance I am
am using has only 11GB of VRAM so the models that I can use are limited.</p>
<p>If you see an out of memory error, it is likely because of insufficient VRAM and you need to either lower the batch size
or choose a different model.</p>
<hr />
<h2 id="saving-your-work">Saving your work</h2>
<p>After you are done with your work, you need to download it off of the server in order to keep it.
Jupyter notebook allows you to select each file individually to download.</p>
<p>To download everything, take a look at <a href="https://stackoverflow.com/questions/43042793/download-all-files-in-a-path-on-jupyter-notebook-server">downloading all files in a path on jupyter notebook</a> or type <code>tar chvfz notebook.tar.gz *</code> in the terminal, which will create a tar
file of everything in the current directory.
<img alt="vastaijupyternotebookdownload" src="/images/vastaijupyternotebookdownload.png" /></p>
<hr />
<h2 id="shutting-down-the-server">Shutting down the server</h2>
<p>When you are done saving your work, you can close the jupyter notebook tabs and go to the instances tab on the
vastai console. After pressing stop, the charges for running the instance will stop but the charges for storage
will continue. It is not recommended to just stop the instance because while the data will be stored on the machine
for later use, it is not guaranteed that you will be able to get the same instace later on. Therefore, it is
recommended to press the destroy button which will stop the instance as well as delete all the data off of the server,
which will stop all charges.</p>
<p><img alt="vastaidestroy" src="/images/vastaidestroy.png" /></p>
<p>After a few seconds of pressing the destroy button, the instance will be deleted and the SSH session will be automatically 
closed.</p>
<p>This is the end of the text tutorial.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../recommendations/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Cloud GPU Recommendations" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Cloud GPU Recommendations
            </div>
          </div>
        </a>
      
      
        
        <a href="../animefacegenerator/" class="md-footer__link md-footer__link--next" aria-label="Next: Project Home" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Project Home
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.e99e714c.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.bc35569b.min.js"></script>
      
    
  </body>
</html>